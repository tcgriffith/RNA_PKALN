---
title: "Untitled"
author: "TC"
date: "11/27/2020"
output: bookdown::pdf_document2
---



# RNAmrf, evolutional covariation aided RNA sequence alignment  


## Introduction

Sequences of proteins, nucleotides(DNAs and RNAs) are essential in the modern biology research. Interestingly, sequences of these molecules have undergone considerable changes during evolution, while preserving the folded structures and biological functions. It has now become a main task to detect homology from diversed sequences, which is usually achieved by alignment methods. Today, alignment methods have been used in fold recognition, function annotation, building phylogenetic trees, finding new motifs or non-coding RNAs, predicting structural and functional features.

There are two closely related alignment problems: pairwise alignment and multiple sequence alignment. Pairwise alignment aims to align two sequences, which can be efficiently solved by dynamic programming methods. Further development of pairwise alignment include the use of additional information from structure constraints and predicted features. 

The multiple sequence alignment problem aims to build an alignment for multiple homologous sequences. Several strategies have been developed: First, pairwise-based alignment methods can be generalized to progressively produce Multiple-sequence alignment, which starts by aligning two sequences and further adds other sequences into alignment. The alignment quality of these methods are determined by the order of the added sequences. Second, researchers have developed consistency scores to evaluate an MSA, and the goal is to iteratively optimize for alignment consistency. However, it is still difficult to build alignment greater than 1000 sequences using these method. Until recently, sequences has become abundant, making it highly desirable to construct larger MSA with thousands and even millions of sequences. For example, the tRNA family has about 1.4 million full sequences. Alignment methods based on the probablistic framework has been developed, as represented by HMMblits and infernal. A simple yet effective strategy to construct larger MSA is to align new sequences to a pre-compiled, manually curated seed alignment. This strategy is closely related to our work presented here.


In this work, we developed MRFalign, a new RNA sequence aligner based on the Markov Random Field(MRF) model. Compared with existing pseudoknot-alignment methods(locaRNA, MARNA), RNAmrf does not need to predict the secondary structures and perform pairwise alignment. Compared with covariance model, CM only allows for incorporating nested base-pairing interactions (pseudoknots are ignored), while MRF is more general, as it allows for the description of a fully connected covariation dependency.

We showed that RNAmrf outperforms cmalign in a synthetic alignment test and real RNA alignment tasks including pseudoknotted structure.


## Methods

### Markov Random Field model for RNA alignment

An RNA structure can be described by a probablistic graph model: nucleotides(A,U,G and C) are represented by nodes, interactions between nucleotides are represented by edges. The distribution of nucleotide types observed in a site is jointly determined by the site preference and coupling interactions.A markov random field (MRF) is introduced to disentangle direct and indirect coupling. It aims at inferring a statistical model $P(A_1,...,A_L)$ for the entire sequence space $A_1,...,A_L$. Given a RNA sequence ($A_1$,...$A_L$), the joint probability $P(A_1,...,A_L)$ in a Boltzmann distribution is described by

$$
P(A_1,...,A_L)=\frac{1}{Z}exp\left \{ {\sum_{i<j}{e_{ij}(A_i,A_j)}}+\sum_{i}{h_i(A_i)} \right \}
$$

where i and j are sequence index of nucleotides $A_i$ and $A_j$. The model parameters are fitted to the MSA. Various approaches are designed to infer the model, include message-passing, mean-field approximation, and pseudolikelihood model. Researchers have used the coupling term $e_{ij}$ to infer physical contacts with success. 

From a thermodynamics perspective, the probability of observing a sequence $A_1,...,A_L$ under a MRF model is determined by its energy. Similarly, we can see the sequence-to-MRF alignment problem as to find the alignment with the highest probability. Additional gap energy terms are required In order to calculate the free energy of a given alignment, but are not included in the MRF model. We used the affine gap penalty to penalize the creation of gaps in an alignment.

Inferring the global optimal alignment in a sequence-to-MRF alignment is an NP problem. Inspired by the map_align method, we sought out to develop a heuristic alignment approach: First, an initial alignment is guessed by using the one-body field accounting for field conservation, using dynamic programming; then the alignment is iteratively refined in search for alignment with lowest energy. 

### Alignment Accuracy Assessment and Test sets

Both the MRF and CM model shares a reference column indexing from the MSA they are built upon, which facilitates the comparison of the alignment from MRF and CM.
The alignment accuracy is evaluated by the percentage of correctly aligned bases in the alignment columns, comparing the test and reference MSA. Additionally, accuracy is evaluated in the loop region, pseudoknot base-pair region and non-pseudoknot base-pair region. When evaluating base-pairs, both nucleotides in a pair are required to be correctly aligned. 

The re-aligned MSAs are further evaluated in the contact prediction task: We employed R-scape to find covariate pairs with statistical significance, and compared with the reference secondary structure.



#### Synthetic Alignment

A synthetic alignment dataset is constructed to compare the performance of MRFalign to state-of-the-art aligner in an extreme setting: starting with a predefined secondary structure that contains two pseudoknotted stems, one thousand random sequences are generated: all four types of nucleotides plus gap are distributed with a frequency of 1/4 on un-paired sites. For the eight base pairs, they are randomly selected from the three canonical base pair types (AU, CG, and GU). 

A covariance model was built with the synthetic MSA and secondary structure annotation using cmbuild. Then the covariance model is used to re-align the sequences. Similarly, a MRF model was trained on the synthetic MSA by GREMLIN, and used to re-align the sequences with MRFalign.

#### Rfam Pseudoknot Families

A total of 37 seed alignment are retrieved from RFAM database. These seed alignments are selected from RNA families with pseudoknots. We only selected RNA families with length less than 200 due to long computation time for constructing the MRF model and alignment. The covariance models shipped with RFAM database was used to re-align the seed alignment. For MRF, the seed alignment is used to construct the model by GREMLIN, and aligned by RNAmrf.


## Results

### Synthetic alignment performance

Table \@ref(tab:tabsynth) shows the alignment accuracy comparing MRFalign and cmalign. Comparing all columns and non-paired columns, RNAmrf has slightly higher alignment accuracy than cmalign. Comparing the alignment for the two stems, cmalign has an average accuracy of 0.49. This is because cmalign aligned the non-pseudoknotted stem almost perfectly (0.96), but failed to align the pairs in the pseudoknot region (accuracy: 0.02). On the other hand, RNAmrf aligns both stems with a robust accuracy (~0.7). Figure \@ref(fig:synthcontact) shows the predicted contacts by DCA, using the synthetic MSA, cmalign-realigned MSA, and MRFalign-realigned MSA, showing a improved accuracy


```{r synthcontact, echo=FALSE, fig.cap="Comparison of DCA predicted contacts using A: synthetic MSA; B: MSA re-aligned by cmalign and C: MSA aligned by MRFalign."}
# load(here::here("data/synth_contact.rda"))
load("~/GIT/thesis_tc/data/synth_contact.rda")
library(patchwork)
synth_contact 
```


```{r tabsynth, echo=FALSE,caption= "Alignment accuracy of cmalign and RNAmrf on the synthetic MSA"}
load("~/GIT/thesis_tc/data/synth_tab.rda")
library(kableExtra)

synth_tab=synth_tab[1:2,1:5]

knitr::kable(synth_tab,caption="", booktab=TRUE, digits=2) 
# mytable=tab
# library(papaja)

```



### RFAM



## Discussion
