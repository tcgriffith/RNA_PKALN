---
title: "Untitled"
author: "TC"
date: "2/28/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(Matrix)
library(dplyr)
library(ggplot2)

source("../R/isorank.R")
library(threejs)

library(igraph)

```


```{r}
ct.ref=RNASSP::read_ct(here::here("data/toy1/ref.ct"))

ct.ss=RNASSP::read_ct(here::here("data/toy1/seq.ss.ct"))
```



```{r}


mat1=ct2mat(ct.ss)

g1=mat2graph(mat1)
ig1=graph_from_data_frame(d=g1$edges,vertices=g1$nodes)

mat2=ct2mat(ct.ref)

g2=mat2graph(mat2)
ig2=graph_from_data_frame(d=g2$edges,vertices=g2$nodes)
```



## vis
```{r}
graphjs(ig1)

graphjs(ig2)
```




## isorank_directed

```{r}
l1=nrow(mat1)
l2=nrow(mat2)


```


```{r}
get_Aseq = function(mat1, mat2) {
  seq1=colnames(mat1)
  seq2=colnames(mat2)
  
  
  matB = matrix(0, nrow = length(seq1), ncol = length(seq1))
  
  for (i in 1:nrow(matB)) {
    for (j in 1:ncol(matB)) {
      if (seq1[i] == seq2[j]) {
        matB[i, j] = 1
      }
    }
  }
  
  matB = matB / sqrt(sum(matB ^ 2))
  
  vB = as.vector(matB)
  
  # vB=vB/sum(vB)
  
  A_seq = vB %*% t(vB)
  
  A_seq.sparse=Matrix::Matrix(A_seq,sparse=TRUE)
  
  return(A_seq.sparse)
}

```

```{r}
A_seq=get_Aseq(mat1,mat2)
```

```{r}
rmatv=get_Rmatv(A_seq,l1,l2,debug=TRUE)

rmat=Rv2Rmat(rmatv[,1000],l1,l2)

gg_mat(rmat)
```


```{r}




```



```{r}
A_seq=
```



```{r}
# do_it_wrapper(0.5, A_bp,A_nb)

rmat=run_isorank_bpnb(mat1,mat2,alpha=.6,iteration=5000)

gg_mat(rmat)
```


```{r}

rmat=run_isorank_bpnbseq(mat1,mat2,alpha=.49,beta=.49,iteration=50000)

gg_mat(rmat)
```


```{r}
extract_aln(rmat)
```

